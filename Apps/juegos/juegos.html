<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=SF+Pro+Display:wght@300;400;500;600&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="juegos.css" />
    <title>Juegos - Nova OS</title>
  </head>
  <body>
    <div class="games-app" id="gamesApp">
      <header class="games-header">
        <div class="header-title">
          <i class="fas fa-gamepad"></i>
          <span>Juegos</span>
        </div>

        <div class="header-actions">
          <button
            class="header-btn"
            onclick="showGamesList()"
            id="backBtn"
            style="display: none"
          >
            <i class="fas fa-arrow-left"></i>
            Atr√°s
          </button>
          <button
            class="header-btn"
            onclick="toggleFullscreen()"
            id="fullscreenBtn"
          >
            <i class="fas fa-expand"></i>
            Pantalla completa
          </button>
        </div>
      </header>

      <div class="games-main" id="gamesMain">
        <aside class="games-sidebar" id="gamesSidebar">
          <div class="sidebar-section">
            <div class="sidebar-title">Categor√≠as</div>
            <ul class="game-category">
              <li class="category-item active" onclick="showCategory('all')">
                <i class="fas fa-gamepad"></i>
                <span>Todos los juegos</span>
              </li>
              <li class="category-item" onclick="showCategory('classic')">
                <i class="fas fa-history"></i>
                <span>Cl√°sicos</span>
              </li>
              <li class="category-item" onclick="showCategory('arcade')">
                <i class="fas fa-joystick"></i>
                <span>Arcade</span>
              </li>
              <li class="category-item" onclick="showCategory('puzzle')">
                <i class="fas fa-puzzle-piece"></i>
                <span>Puzzle</span>
              </li>
            </ul>
          </div>

          <div class="sidebar-section">
            <div class="sidebar-title">Informaci√≥n</div>
            <ul class="game-category">
              <li class="category-item" onclick="showGameStats()">
                <i class="fas fa-chart-line"></i>
                <span>Estad√≠sticas</span>
              </li>
              <li class="category-item">
                <i class="fas fa-cog"></i>
                <span>Configuraci√≥n</span>
              </li>
              <li class="category-item">
                <i class="fas fa-question-circle"></i>
                <span>Ayuda</span>
              </li>
            </ul>
          </div>
        </aside>

        <div class="game-area">
          <div class="game-banner" id="gameBanner">
            <div class="game-icon-large">
              <i class="fas fa-cube"></i>
            </div>
            <div class="game-info-large">
              <h1 class="game-title">Minecraft Classic</h1>
              <p class="game-description">
                La versi√≥n original de Minecraft en el navegador. ¬°Construye,
                explora y crea!
              </p>
              <div class="game-meta">
                <span><i class="fas fa-clock"></i> 2009</span>
                <span><i class="fas fa-user"></i> 1 jugador</span>
                <span><i class="fas fa-star"></i> Cl√°sico</span>
              </div>
            </div>
            <button class="game-action" onclick="playMinecraft()">
              <i class="fas fa-play"></i>
              Jugar Ahora
            </button>
          </div>

          <div class="games-list-view" id="gamesListView">
            <div class="game-card" onclick="playMinecraft()">
              <div class="game-card-icon minecraft-icon">
                <i class="fas fa-cube"></i>
              </div>
              <h3 class="game-card-title">Minecraft Classic</h3>
              <p class="game-card-desc">Construcci√≥n creativa en 3D</p>
              <div class="game-meta" style="font-size: 10px; gap: 8px">
                <span><i class="fas fa-clock"></i> 2009</span>
                <span><i class="fas fa-star"></i> Cl√°sico</span>
              </div>
            </div>

            <!-- DOOM -->
            <div class="game-card" onclick="playDoom()">
              <div class="game-card-icon doom-icon">
                <i class="fas fa-skull-crossbones"></i>
              </div>
              <h3 class="game-card-title">DOOM Classic</h3>
              <p class="game-card-desc">FPS cl√°sico de acci√≥n</p>
              <div class="game-meta" style="font-size: 10px; gap: 8px">
                <span><i class="fas fa-clock"></i> 1993</span>
                <span><i class="fas fa-star"></i> Acci√≥n</span>
              </div>
            </div>

            <!-- Pac-Man -->
            <div class="game-card" onclick="playPacman()">
              <div class="game-card-icon pacman-icon">
                <i class="fas fa-ghost"></i>
              </div>
              <h3 class="game-card-title">Pac-Man</h3>
              <p class="game-card-desc">Come puntos, evita fantasmas</p>
              <div class="game-meta" style="font-size: 10px; gap: 8px">
                <span><i class="fas fa-clock"></i> 1980</span>
                <span><i class="fas fa-star"></i> Arcade</span>
              </div>
            </div>

            <!-- Tetris -->
            <div class="game-card" onclick="playTetris()">
              <div class="game-card-icon tetris-icon">
                <i class="fas fa-gamepad"></i>
              </div>
              <h3 class="game-card-title">Tetris</h3>
              <p class="game-card-desc">Juego de bloques ruso</p>
              <div class="game-meta" style="font-size: 10px; gap: 8px">
                <span><i class="fas fa-clock"></i> 1984</span>
                <span><i class="fas fa-star"></i> Puzzle</span>
              </div>
            </div>

            <!-- Snake -->
            <div class="game-card" onclick="playSnake()">
              <div class="game-card-icon snake-icon">
                <i class="fas fa-snake"></i>
              </div>
              <h3 class="game-card-title">Snake</h3>
              <p class="game-card-desc">Controla la serpiente hambrienta</p>
              <div class="game-meta" style="font-size: 10px; gap: 8px">
                <span><i class="fas fa-clock"></i> 1976</span>
                <span><i class="fas fa-star"></i> Arcade</span>
              </div>
            </div>

            <!-- Space Invaders -->
            <div class="game-card" onclick="playSpaceInvaders()">
              <div class="game-card-icon space-icon">
                <i class="fas fa-space-shuttle"></i>
              </div>
              <h3 class="game-card-title">Space Invaders</h3>
              <p class="game-card-desc">Defiende la Tierra</p>
              <div class="game-meta" style="font-size: 10px; gap: 8px">
                <span><i class="fas fa-clock"></i> 1978</span>
                <span><i class="fas fa-star"></i> Arcade</span>
              </div>
            </div>

            <!-- Chess -->
            <div class="game-card" onclick="playChess()">
              <div class="game-card-icon chess-icon">
                <i class="fas fa-chess"></i>
              </div>
              <h3 class="game-card-title">Ajedrez</h3>
              <p class="game-card-desc">Juego de estrategia cl√°sico</p>
              <div class="game-meta" style="font-size: 10px; gap: 8px">
                <span><i class="fas fa-clock"></i> Siglo VI</span>
                <span><i class="fas fa-star"></i> Estrategia</span>
              </div>
            </div>
          </div>

          <!-- Contenedor del juego (oculto inicialmente) -->
          <div class="game-container" id="gameContainer" style="display: none">
            <div class="game-loading" id="gameLoading">
              <div class="loading-spinner"></div>
              <div class="loading-text">Cargando juego...</div>
            </div>
            <!-- El iframe se insertar√° aqu√≠ -->
          </div>
        </div>
      </div>

      <!-- Panel de control inferior -->
      <div class="game-controls" id="gameControls" style="display: none">
        <button class="control-btn" onclick="pauseGame()">
          <i class="fas fa-pause"></i>
          Pausa
        </button>
        <button class="control-btn" onclick="restartGame()">
          <i class="fas fa-redo"></i>
          Reiniciar
        </button>
        <button class="control-btn primary" onclick="showGamesList()">
          <i class="fas fa-times"></i>
          Salir del juego
        </button>

        <div class="game-stats">
          <div class="stat">
            <div class="stat-value" id="gameTime">00:00</div>
            <div class="stat-label">Tiempo</div>
          </div>
          <div class="stat">
            <div class="stat-value" id="gameStatus">Activo</div>
            <div class="stat-label">Estado</div>
          </div>
        </div>
      </div>
    </div>

    <script>
      // Variables globales
      let gameIframe = null;
      let gameTimer = 0;
      let timerInterval = null;
      let isGameActive = false;
      let currentGame = null;

      // Juegos disponibles
      const games = {
        minecraft: {
          url: "https://classic.minecraft.net",
          title: "Minecraft Classic",
          description:
            "La versi√≥n original de Minecraft en el navegador. ¬°Construye, explora y crea!",
          year: "2009",
          category: "classic",
          controls: "WASD: Movimiento, Click: Colocar bloque, Espacio: Saltar",
        },
        doom: {
          url: "../doom/doom.html",
          title: "DOOM Classic",
          description:
            "El cl√°sico juego de acci√≥n en primera persona que revolucion√≥ el g√©nero.",
          year: "1993",
          category: "classic",
          controls: "Flechas: Movimiento, Ctrl: Disparar, Espacio: Acci√≥n",
        },
        pacman: {
          url: "https://freepacman.org",
          title: "Pac-Man",
          description:
            "El cl√°sico juego de arcade. Come todos los puntos mientras evitas a los fantasmas.",
          year: "1980",
          category: "arcade",
          controls: "Flechas: Movimiento",
        },
        tetris: {
          url: "https://tetris.com/play-tetris",
          title: "Tetris",
          description:
            "El legendario juego de bloques rusos. Rota y coloca las piezas para formar l√≠neas.",
          year: "1984",
          category: "puzzle",
          controls: "Flechas: Mover y rotar, Espacio: Bajar r√°pido",
        },
        snake: {
          url: "https://playsnake.org",
          title: "Snake",
          description:
            "Controla una serpiente hambrienta. Come la comida y crece, pero no te muerdas a ti mismo.",
          year: "1976",
          category: "arcade",
          controls: "Flechas: Direcci√≥n",
        },
        spaceinvaders: {
          url: "https://freeinvaders.org",
          title: "Space Invaders",
          description:
            "Defiende la Tierra de una invasi√≥n alien√≠gena. Dispara a los invasores del espacio.",
          year: "1978",
          category: "arcade",
          controls: "Flechas: Movimiento, Espacio: Disparar",
        },
        chess: {
          url: "https://www.chess.com/play/computer",
          title: "Ajedrez",
          description:
            "El juego de estrategia m√°s famoso del mundo. Juega contra la computadora.",
          year: "Siglo VI",
          category: "strategy",
          controls: "Mouse: Seleccionar y mover piezas",
        },
      };

      // Funci√≥n para jugar Minecraft
      function playMinecraft() {
        openGame("minecraft");
      }

      // Funci√≥n para jugar DOOM
      function playDoom() {
        openGame("doom");
      }

      // Funci√≥n para jugar Pac-Man
      function playPacman() {
        openGame("pacman");
      }

      // Funci√≥n para jugar Tetris
      function playTetris() {
        openGame("tetris");
      }

      // Funci√≥n para jugar Snake
      function playSnake() {
        openGame("snake");
      }

      // Funci√≥n para jugar Space Invaders
      function playSpaceInvaders() {
        openGame("spaceinvaders");
      }

      // Funci√≥n para jugar Ajedrez
      function playChess() {
        openGame("chess");
      }

      function openGame(gameId) {
        const game = games[gameId];
        if (!game) return;

        const app = document.getElementById("gamesApp");
        const banner = document.getElementById("gameBanner");
        const listView = document.getElementById("gamesListView");
        const gameContainer = document.getElementById("gameContainer");
        const gameLoading = document.getElementById("gameLoading");
        const gameControls = document.getElementById("gameControls");
        const backBtn = document.getElementById("backBtn");
        const fullscreenBtn = document.getElementById("fullscreenBtn");
        const gameTitle = document.querySelector(".game-title");
        const gameDescription = document.querySelector(".game-description");
        const gameIcon = document.querySelector(".game-icon-large");
        const gameMeta = document.querySelector(".game-meta");

        app.classList.add("game-active");
        banner.style.display = "none";
        listView.style.display = "none";
        gameContainer.style.display = "block";
        gameControls.style.display = "flex";
        backBtn.style.display = "flex";
        fullscreenBtn.style.display = "none";

        currentGame = gameId;
        isGameActive = true;

        if (gameTitle) gameTitle.textContent = game.title;
        if (gameDescription) gameDescription.textContent = game.description;

        if (gameIcon) {
          gameIcon.innerHTML = `<i class="fas fa-${getGameIcon(gameId)}"></i>`;
          gameIcon.style.background = getGameGradient(gameId);
        }

        if (gameMeta) {
          gameMeta.innerHTML = `
                    <span><i class="fas fa-clock"></i> ${game.year}</span>
                    <span><i class="fas fa-user"></i> 1 jugador</span>
                    <span><i class="fas fa-star"></i> ${game.category}</span>
                `;
        }

        gameLoading.style.display = "flex";
        gameLoading.querySelector(
          ".loading-text"
        ).textContent = `Cargando ${game.title}...`;

        setTimeout(() => {
          if (gameIframe) {
            gameIframe.remove();
          }

          gameIframe = document.createElement("iframe");
          gameIframe.className = "game-frame";
          gameIframe.src = game.url;
          gameIframe.title = game.title;
          gameIframe.allow = "fullscreen";
          gameIframe.referrerpolicy = "no-referrer";

          gameIframe.onload = () => {
            gameLoading.style.display = "none";
            startGameTimer();

            if (window.parent && window.parent.webOS) {
              window.parent.webOS.showNotification(
                `${game.title} iniciado`,
                "success"
              );
            }
          };

          gameIframe.onerror = () => {
            gameLoading.innerHTML = `
                        <div style="text-align: center;">
                            <i class="fas fa-exclamation-triangle" style="font-size: 48px; color: #ff6b6b; margin-bottom: 16px;"></i>
                            <div class="loading-text" style="color: #ff6b6b; margin-bottom: 16px;">Error al cargar ${game.title}</div>
                            <p style="color: var(--text-secondary); font-size: 12px; margin-bottom: 20px;">
                                El juego podr√≠a no estar disponible temporalmente.
                            </p>
                            <div style="display: flex; gap: 10px; justify-content: center;">
                                <button onclick="openGame('${gameId}')" style="background: var(--accent-primary); color: var(--bg-primary); border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-weight: 600;">
                                    <i class="fas fa-redo"></i> Reintentar
                                </button>
                                <button onclick="window.open('${game.url}', '_blank')" style="background: transparent; color: var(--text-primary); border: 1px solid var(--border-color); padding: 8px 16px; border-radius: 6px; cursor: pointer;">
                                    <i class="fas fa-external-link-alt"></i> Abrir en nueva pesta√±a
                                </button>
                            </div>
                        </div>
                    `;
          };

          gameContainer.appendChild(gameIframe);
        }, 500);
      }

      function getGameIcon(gameId) {
        const icons = {
          minecraft: "cube",
          doom: "skull-crossbones",
          pacman: "ghost",
          tetris: "gamepad",
          snake: "snake",
          spaceinvaders: "space-shuttle",
          chess: "chess",
        };
        return icons[gameId] || "gamepad";
      }

      function getGameGradient(gameId) {
        const gradients = {
          minecraft: "linear-gradient(135deg, #6cc24a 0%, #4a8c2c 100%)",
          doom: "linear-gradient(135deg, #ff4757 0%, #ff6b81 100%)",
          pacman: "linear-gradient(135deg, #ffd166 0%, #ffb347 100%)",
          tetris: "linear-gradient(135deg, #4cc9f0 0%, #4361ee 100%)",
          snake: "linear-gradient(135deg, #2ecc71 0%, #27ae60 100%)",
          spaceinvaders: "linear-gradient(135deg, #9b59b6 0%, #8e44ad 100%)",
          chess: "linear-gradient(135deg, #95a5a6 0%, #7f8c8d 100%)",
        };
        return gradients[gameId] || "var(--gradient-primary)";
      }

      function showGamesList() {
        const app = document.getElementById("gamesApp");
        const banner = document.getElementById("gameBanner");
        const listView = document.getElementById("gamesListView");
        const gameContainer = document.getElementById("gameContainer");
        const gameControls = document.getElementById("gameControls");
        const backBtn = document.getElementById("backBtn");
        const fullscreenBtn = document.getElementById("fullscreenBtn");

        app.classList.remove("game-active");
        banner.style.display = "flex";
        listView.style.display = "grid";
        gameContainer.style.display = "none";
        gameControls.style.display = "none";
        backBtn.style.display = "none";
        fullscreenBtn.style.display = "flex";

        isGameActive = false;

        if (gameIframe) {
          gameIframe.remove();
          gameIframe = null;
        }

        stopGameTimer();

        if (window.parent && window.parent.webOS) {
          window.parent.webOS.showNotification("Juego finalizado", "info");
        }
      }

      function startGameTimer() {
        stopGameTimer();
        gameTimer = 0;
        updateTimerDisplay();

        timerInterval = setInterval(() => {
          gameTimer++;
          updateTimerDisplay();
        }, 1000);
      }

      function stopGameTimer() {
        if (timerInterval) {
          clearInterval(timerInterval);
          timerInterval = null;
        }
      }

      function updateTimerDisplay() {
        const minutes = Math.floor(gameTimer / 60);
        const seconds = gameTimer % 60;
        document.getElementById("gameTime").textContent = `${minutes
          .toString()
          .padStart(2, "0")}:${seconds.toString().padStart(2, "0")}`;
      }

      function toggleFullscreen() {
        const gameContainer = document.getElementById("gameContainer");
        const fullscreenBtn = document.getElementById("fullscreenBtn");

        if (!document.fullscreenElement) {
          const element = isGameActive
            ? gameContainer
            : document.documentElement;

          if (element.requestFullscreen) {
            element.requestFullscreen();
          } else if (element.webkitRequestFullscreen) {
            element.webkitRequestFullscreen();
          } else if (element.msRequestFullscreen) {
            element.msRequestFullscreen();
          }

          fullscreenBtn.innerHTML =
            '<i class="fas fa-compress"></i> Salir pantalla completa';
        } else {
          if (document.exitFullscreen) {
            document.exitFullscreen();
          } else if (document.webkitExitFullscreen) {
            document.webkitExitFullscreen();
          } else if (document.msExitFullscreen) {
            document.msExitFullscreen();
          }

          fullscreenBtn.innerHTML =
            '<i class="fas fa-expand"></i> Pantalla completa';
        }
      }

      document.addEventListener("fullscreenchange", updateFullscreenButton);
      document.addEventListener(
        "webkitfullscreenchange",
        updateFullscreenButton
      );
      document.addEventListener("msfullscreenchange", updateFullscreenButton);

      function updateFullscreenButton() {
        const isFullscreen =
          !!document.fullscreenElement ||
          !!document.webkitFullscreenElement ||
          !!document.msFullscreenElement;
        const fullscreenBtn = document.getElementById("fullscreenBtn");

        if (isFullscreen) {
          fullscreenBtn.innerHTML =
            '<i class="fas fa-compress"></i> Salir pantalla completa';
        } else {
          fullscreenBtn.innerHTML =
            '<i class="fas fa-expand"></i> Pantalla completa';
        }
      }

      function pauseGame() {
        if (gameIframe && gameIframe.contentWindow) {
          try {
            gameIframe.contentWindow.postMessage("pause", "*");
          } catch (e) {
            console.log("No se pudo pausar el juego");
          }
        }
      }

      function restartGame() {
        if (gameIframe && currentGame) {
          gameIframe.src = gameIframe.src;
          startGameTimer();
        }
      }

      function showCategory(category) {
        document.querySelectorAll(".category-item").forEach((item) => {
          item.classList.remove("active");
        });
        event.currentTarget.classList.add("active");

        const gameCards = document.querySelectorAll(".game-card");
        gameCards.forEach((card) => {
          const gameTitle = card.querySelector(".game-card-title").textContent;
          const game = Object.values(games).find((g) => g.title === gameTitle);

          if (category === "all" || (game && game.category === category)) {
            card.style.display = "flex";
          } else {
            card.style.display = "none";
          }
        });
      }

      // Funciones auxiliares
      function showGameStats() {
        const stats = {
          totalPlayTime: formatTime(gameTimer),
          gamesPlayed: currentGame ? 1 : 0,
          favoriteGame: currentGame || "Ninguno",
        };

        alert(
          `üéÆ Estad√≠sticas de juego\n\n‚è±Ô∏è Tiempo total: ${stats.totalPlayTime}\nüé≤ Juegos jugados: ${stats.gamesPlayed}\n‚≠ê Favorito: ${stats.favoriteGame}`
        );
      }

      function formatTime(seconds) {
        const hours = Math.floor(seconds / 3600);
        const minutes = Math.floor((seconds % 3600) / 60);
        const secs = seconds % 60;

        if (hours > 0) {
          return `${hours}h ${minutes}m ${secs}s`;
        } else if (minutes > 0) {
          return `${minutes}m ${secs}s`;
        } else {
          return `${secs}s`;
        }
      }

      document.addEventListener("DOMContentLoaded", function () {
        console.log("App de juegos cargada");

        document.getElementById("gameStatus").textContent = "Inactivo";
      });

      window.addEventListener("message", function (event) {
        console.log("Mensaje del juego:", event.data);

        if (event.data === "gameOver" || event.data === "levelComplete") {
          if (window.parent && window.parent.webOS) {
            window.parent.webOS.showNotification(
              "Juego: " + event.data,
              "info"
            );
          }
        }
      });
    </script>
  </body>
</html>
